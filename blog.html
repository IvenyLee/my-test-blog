<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Blog - Limorgen's Blog</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Limorgen's Blog</h1>
        <nav>
            <a href="index.html">HOME</a>
            <a href="blog.html">BLOG</a>
            <a href="gallery.html">GALLERY</a>
            <a href="about.html">ABOUT ME</a>
        </nav>
    </header>

    <main>
        <!-- 文章目录区域 -->
        <section id="blog-list">
            <h2>blog</h2>
            <ul id="post-list"></ul>
        </section>

        <!-- 单篇文章阅读区域 -->
        <section id="blog-post" style="display: none;">
            <button onclick="backToList()">← 返回文章列表</button>
            <div id="post-content"></div>
        </section>
    </main>

    <footer>
        <p>&copy; Limorgen</p>
    </footer>

    <script>
        function loadPostList() {
            fetch('posts/index.json')
                .then(response => response.json())
                .then(posts => {
                    const ul = document.getElementById('post-list');
                    posts.forEach(post => {
                        const li = document.createElement("li");
                        const a = document.createElement("a");
                        a.href = "#";
                        a.textContent = post.title;
                        a.onclick = (e) => {
                            e.preventDefault();
                            showPost(post.file);
                        };
                        li.appendChild(a);
                        ul.appendChild(li);
                    });
                });
        }

        function showPost(file) {
            document.getElementById("blog-list").style.display = "none";
            document.getElementById("blog-post").style.display = "block";
            const container = document.getElementById("post-content");
            container.innerHTML = "加载中...";

            fetch('posts/' + file)
                .then(response => response.text())
                .then(text => {
                    text = text.replace(/\[image:(.*?) caption:(.*?)\]/g,
                        '<figure><img src="images/$1" style="max-width:100%"><figcaption>$2</figcaption></figure>'
                    );
                    text = text.replace(/\[video:(.*?) caption:(.*?)\]/g,
                        '<figure><video controls style="max-width:100%"><source src="videos/$1" type="video/mp4"></video><figcaption>$2</figcaption></figure>'
                    );
                    text = text.replace(/\[youtube:(.*?) caption:(.*?)\]/g,
                        '<figure><iframe width="100%" height="315" src="$1" frameborder="0" allowfullscreen></iframe><figcaption>$2</figcaption></figure>'
                    );
                    text = text.replace(/^# (.*?)$/gm, '<h2>$1</h2>');
                    text = text.replace(/\n/g, '<br>');

                    container.innerHTML = text;
                });
        }

        function backToList() {
            document.getElementById("blog-list").style.display = "block";
            document.getElementById("blog-post").style.display = "none";
            document.getElementById("post-content").innerHTML = "";
        }

        window.onload = loadPostList;
    </script>
</body>
</html>
